<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test Suite - –î–æ—Å–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 30px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .config-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .config-section h2 {
            margin-bottom: 15px;
            color: #495057;
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #495057;
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .results {
            margin-top: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }

        .test-section-header {
            background: #343a40;
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .test-section-header:hover {
            background: #23272b;
        }

        .test-section-content {
            padding: 20px;
            display: none;
        }

        .test-section-content.active {
            display: block;
        }

        .test-case {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }

        .test-case.success {
            border-left-color: #28a745;
        }

        .test-case.error {
            border-left-color: #dc3545;
        }

        .test-case-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .test-case-title {
            font-weight: 600;
            color: #212529;
        }

        .test-case-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .test-case-details {
            margin-top: 10px;
            font-size: 13px;
            color: #6c757d;
        }

        .test-case-details pre {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            margin-top: 5px;
            font-size: 12px;
        }

        .summary {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px solid #b3d9ff;
        }

        .summary h2 {
            margin-bottom: 15px;
            color: #004085;
        }

        .summary-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat {
            padding: 15px;
            background: white;
            border-radius: 6px;
            min-width: 150px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #007bff;
        }

        .stat-label {
            color: #6c757d;
            font-size: 14px;
            margin-top: 5px;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ API Test Suite</h1>
        <p class="subtitle">–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã API –¥–æ—Å–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>

        <div class="config-section">
            <h2>‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h2>
            <div class="form-group">
                <label for="baseUrl">Base URL:</label>
                <input type="text" id="baseUrl" value="http://localhost:8080" placeholder="http://localhost:8080">
            </div>
            <div class="form-group">
                <label for="testUsername">–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (username):</label>
                <input type="text" id="testUsername" value="user1" placeholder="user1">
            </div>
            <div class="form-group">
                <label for="testPassword">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="testPassword" value="password" placeholder="password">
            </div>
            <div class="form-group">
                <label for="testUsername2">–í—Ç–æ—Ä–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–¥–ª—è —Ç–µ—Å—Ç–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π):</label>
                <input type="text" id="testUsername2" value="user2" placeholder="user2">
            </div>
            <div class="form-group">
                <label for="testPassword2">–ü–∞—Ä–æ–ª—å –≤—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="password" id="testPassword2" value="password" placeholder="password">
            </div>
        </div>

        <div class="button-group">
            <button class="btn-primary" onclick="runAllTests()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
            <button class="btn-success" onclick="testAuth()">üîê –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</button>
            <button class="btn-info" onclick="testCategories()">üìÅ –¢–µ—Å—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π</button>
            <button class="btn-warning" onclick="testListings()">üìã –¢–µ—Å—Ç—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π</button>
            <button class="btn-secondary" onclick="testMessages()">üí¨ –¢–µ—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π</button>
            <button class="btn-danger" onclick="testReports()">‚ö†Ô∏è –¢–µ—Å—Ç—ã –∂–∞–ª–æ–±</button>
            <button class="btn-primary" onclick="testUsers()">üë§ –¢–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            <button class="btn-secondary" onclick="clearResults()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        </div>

        <div id="summary" class="summary hidden">
            <h2>üìä –°–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
            <div class="summary-stats">
                <div class="stat">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="passedTests" style="color: #28a745;">0</div>
                    <div class="stat-label">–£—Å–ø–µ—à–Ω–æ</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="failedTests" style="color: #dc3545;">0</div>
                    <div class="stat-label">–û—à–∏–±–æ–∫</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="successRate">0%</div>
                    <div class="stat-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                </div>
            </div>
        </div>

        <div id="results" class="results"></div>
    </div>

    <script>
        const BASE_URL_KEY = 'api_test_base_url';
        const TEST_USERNAME_KEY = 'api_test_username';
        const TEST_PASSWORD_KEY = 'api_test_password';

        let testResults = {
            total: 0,
            passed: 0,
            failed: 0
        };

        let createdResources = {
            categories: [],
            listings: [],
            messages: [],
            reports: [],
            users: []
        };

        function getBaseUrl() {
            return document.getElementById('baseUrl').value || 'http://localhost:8080';
        }

        function getTestUsername() {
            return document.getElementById('testUsername').value || 'user1';
        }

        function getTestPassword() {
            return document.getElementById('testPassword').value || 'password';
        }

        function getTestUsername2() {
            return document.getElementById('testUsername2').value || 'user2';
        }

        function getTestPassword2() {
            return document.getElementById('testPassword2').value || 'password';
        }

        async function makeRequest(method, url, body = null, useAuth = false) {
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            };

            if (body) {
                options.body = JSON.stringify(body);
            }

            if (useAuth) {
                const username = getTestUsername();
                const password = getTestPassword();
                const auth = btoa(`${username}:${password}`);
                options.headers['Authorization'] = `Basic ${auth}`;
            }

            try {
                const response = await fetch(url, options);
                const contentType = response.headers.get('content-type');
                let data = null;
                
                if (contentType && contentType.includes('application/json')) {
                    try {
                        data = await response.json();
                    } catch (e) {
                        data = { text: await response.text() };
                    }
                } else {
                    data = { text: await response.text() };
                }

                return {
                    ok: response.ok,
                    status: response.status,
                    statusText: response.statusText,
                    data: data
                };
            } catch (error) {
                return {
                    ok: false,
                    status: 0,
                    statusText: 'Network Error',
                    data: { error: error.message }
                };
            }
        }

        async function login(username, password) {
            const baseUrl = getBaseUrl();
            try {
                const response = await fetch(`${baseUrl}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    credentials: 'include',
                    body: `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`
                });
                return response.ok;
            } catch (error) {
                console.error('Login error:', error);
                return false;
            }
        }

        function addTestResult(section, title, passed, details) {
            testResults.total++;
            if (passed) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }

            const resultsDiv = document.getElementById('results');
            let sectionDiv = document.getElementById(`section-${section}`);
            
            if (!sectionDiv) {
                sectionDiv = document.createElement('div');
                sectionDiv.className = 'test-section';
                sectionDiv.id = `section-${section}`;
                sectionDiv.innerHTML = `
                    <div class="test-section-header" onclick="toggleSection('${section}')">
                        <span>${getSectionTitle(section)}</span>
                        <span id="section-${section}-count">0 —Ç–µ—Å—Ç–æ–≤</span>
                    </div>
                    <div class="test-section-content" id="section-${section}-content"></div>
                `;
                resultsDiv.appendChild(sectionDiv);
            }

            const contentDiv = document.getElementById(`section-${section}-content`);
            contentDiv.classList.add('active');
            
            const testCaseDiv = document.createElement('div');
            testCaseDiv.className = `test-case ${passed ? 'success' : 'error'}`;
            testCaseDiv.innerHTML = `
                <div class="test-case-header">
                    <span class="test-case-title">${title}</span>
                    <span class="test-case-status ${passed ? 'status-success' : 'status-error'}">
                        ${passed ? '‚úì –£—Å–ø–µ—à–Ω–æ' : '‚úó –û—à–∏–±–∫–∞'}
                    </span>
                </div>
                <div class="test-case-details">
                    ${details}
                </div>
            `;
            contentDiv.appendChild(testCaseDiv);

            const countSpan = document.getElementById(`section-${section}-count`);
            const currentCount = parseInt(countSpan.textContent) || 0;
            countSpan.textContent = `${currentCount + 1} —Ç–µ—Å—Ç–æ–≤`;

            updateSummary();
        }

        function getSectionTitle(section) {
            const titles = {
                'auth': 'üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è',
                'categories': 'üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏',
                'listings': 'üìã –û–±—ä—è–≤–ª–µ–Ω–∏—è',
                'messages': 'üí¨ –°–æ–æ–±—â–µ–Ω–∏—è',
                'reports': '‚ö†Ô∏è –ñ–∞–ª–æ–±—ã',
                'users': 'üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏'
            };
            return titles[section] || section;
        }

        function toggleSection(section) {
            const content = document.getElementById(`section-${section}-content`);
            content.classList.toggle('active');
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('summary');
            summaryDiv.classList.remove('hidden');
            
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            
            const successRate = testResults.total > 0 
                ? Math.round((testResults.passed / testResults.total) * 100) 
                : 0;
            document.getElementById('successRate').textContent = `${successRate}%`;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            testResults = { total: 0, passed: 0, failed: 0 };
            createdResources = {
                categories: [],
                listings: [],
                messages: [],
                reports: [],
                users: []
            };
            document.getElementById('summary').classList.add('hidden');
        }

        async function testAuth() {
            const baseUrl = getBaseUrl();
            
            const connectivityTest = await makeRequest('GET', `${baseUrl}/api/categories`);
            if (connectivityTest.status === 0) {
                addTestResult('auth', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', false,
                    `‚úó –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É ${baseUrl}<br>
                    –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:<br>
                    1. –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω - –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Spring Boot<br>
                    2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Base URL - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞<br>
                    3. CORS –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã - –æ—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π<br>
                    4. –§–∞–π–ª –æ—Ç–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ file:// - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ http://localhost<br><br>
                    <strong>–í–∞–∂–Ω–æ:</strong> –ï—Å–ª–∏ –≤—ã –æ—Ç–∫—Ä—ã–ª–∏ —Ñ–∞–π–ª –Ω–∞–ø—Ä—è–º—É—é (file://), –±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∏–∑-–∑–∞ CORS. 
                    –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª —á–µ—Ä–µ–∑ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∏–ª–∏ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç–µ –µ–≥–æ –≤ –ø–∞–ø–∫–µ static –≤–∞—à–µ–≥–æ Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.`);
                return;
            }
            
            addTestResult('auth', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', true,
                `‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É —É—Å–ø–µ—à–Ω–æ (${baseUrl})`);
            
            const meResponseUnauth = await makeRequest('GET', `${baseUrl}/api/users/me`);
            let testPassed = false;
            let testDetails = '';
            
            if (meResponseUnauth.status === 0) {
                testDetails = `‚úó –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: –∑–∞–ø—Ä–æ—Å –Ω–µ –¥–æ—à–µ–ª –¥–æ —Å–µ—Ä–≤–µ—Ä–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.`;
            } else if (!meResponseUnauth.ok && (meResponseUnauth.status === 401 || meResponseUnauth.status === 403)) {
                testPassed = true;
                testDetails = `‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –∑–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω–µ–Ω —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º ${meResponseUnauth.status} (–æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)`;
            } else if (meResponseUnauth.ok) {
                testDetails = `‚úó –û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: –∑–∞–ø—Ä–æ—Å –ø—Ä–æ—à–µ–ª –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Å—Ç–∞—Ç—É—Å ${meResponseUnauth.status}). –≠—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ!`;
            } else {
                testDetails = `‚úó –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å: ${meResponseUnauth.status}. –û–∂–∏–¥–∞–ª—Å—è 401/403 –¥–ª—è –Ω–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.`;
            }
            
            addTestResult('auth', 'GET /api/users/me (–±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)', testPassed, testDetails);

            const loginResult = await login(getTestUsername(), getTestPassword());
            let loginDetails = '';
            if (loginResult) {
                loginDetails = `‚úì –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${getTestUsername()})`;
            } else {
                loginDetails = `‚úó –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:<br>
                    - –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å username: <strong>${getTestUsername()}</strong><br>
                    - –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å password<br>
                    - –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö<br>
                    - –ó–∞–ø—É—â–µ–Ω –ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–∞ ${baseUrl}`;
            }
            addTestResult('auth', 'POST /login (—Å–µ—Å—Å–∏–æ–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)', loginResult, loginDetails);

            if (loginResult) {
                const meResponse = await makeRequest('GET', `${baseUrl}/api/users/me`);
                addTestResult('auth', 'GET /api/users/me (–ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞)', meResponse.ok,
                    `Status: ${meResponse.status}<br>Data: <pre>${JSON.stringify(meResponse.data, null, 2)}</pre>`);
            }

            const registerData = {
                username: `testuser_${Date.now()}`,
                email: `test_${Date.now()}@example.com`,
                password: 'TestPassword123!',
                role: 'USER'
            };
            const registerResponse = await makeRequest('POST', `${baseUrl}/auth/register`, registerData);
            addTestResult('auth', 'POST /auth/register', registerResponse.ok && registerResponse.status === 201,
                `Status: ${registerResponse.status}<br>Data: <pre>${JSON.stringify(registerResponse.data, null, 2)}</pre>`);
            
            if (registerResponse.ok && registerResponse.data && registerResponse.data.id) {
                createdResources.users.push(registerResponse.data.id);
            }
        }

        async function testCategories() {
            const baseUrl = getBaseUrl();
            await login(getTestUsername(), getTestPassword());

            const getAllResponse = await makeRequest('GET', `${baseUrl}/api/categories`);
            addTestResult('categories', 'GET /api/categories', getAllResponse.ok,
                `Status: ${getAllResponse.status}<br>–ù–∞–π–¥–µ–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: ${Array.isArray(getAllResponse.data) ? getAllResponse.data.length : 0}`);

            if (getAllResponse.ok && Array.isArray(getAllResponse.data) && getAllResponse.data.length > 0) {
                const firstCategory = getAllResponse.data[0];
                const getByIdResponse = await makeRequest('GET', `${baseUrl}/api/categories/${firstCategory.id}`);
                addTestResult('categories', `GET /api/categories/${firstCategory.id}`, getByIdResponse.ok,
                    `Status: ${getByIdResponse.status}<br>Data: <pre>${JSON.stringify(getByIdResponse.data, null, 2)}</pre>`);
            }

            const createData = {
                name: `Test Category ${Date.now()}`,
                description: 'Test category description'
            };
            const createResponse = await makeRequest('POST', `${baseUrl}/api/categories`, createData);
            addTestResult('categories', 'POST /api/categories', createResponse.ok && createResponse.status === 201,
                `Status: ${createResponse.status}<br>Data: <pre>${JSON.stringify(createResponse.data, null, 2)}</pre>`);
            
            if (createResponse.ok && createResponse.data && createResponse.data.id) {
                const categoryId = createResponse.data.id;
                createdResources.categories.push(categoryId);

                const updateData = {
                    name: `Updated Category ${Date.now()}`,
                    description: 'Updated description'
                };
                const updateResponse = await makeRequest('PUT', `${baseUrl}/api/categories/${categoryId}`, updateData);
                addTestResult('categories', `PUT /api/categories/${categoryId}`, updateResponse.ok,
                    `Status: ${updateResponse.status}<br>Data: <pre>${JSON.stringify(updateResponse.data, null, 2)}</pre>`);

                const deleteResponse = await makeRequest('DELETE', `${baseUrl}/api/categories/${categoryId}`);
                addTestResult('categories', `DELETE /api/categories/${categoryId}`, deleteResponse.ok && deleteResponse.status === 204,
                    `Status: ${deleteResponse.status}`);
                
                if (deleteResponse.ok) {
                    createdResources.categories = createdResources.categories.filter(id => id !== categoryId);
                }
            }
        }

        async function testListings() {
            const baseUrl = getBaseUrl();
            await login(getTestUsername(), getTestPassword());

            const getAllResponse = await makeRequest('GET', `${baseUrl}/api/listings`);
            addTestResult('listings', 'GET /api/listings', getAllResponse.ok,
                `Status: ${getAllResponse.status}<br>–ù–∞–π–¥–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π: ${Array.isArray(getAllResponse.data) ? getAllResponse.data.length : 0}`);

            const getAllIncludingInactive = await makeRequest('GET', `${baseUrl}/api/listings/all`);
            addTestResult('listings', 'GET /api/listings/all', getAllIncludingInactive.ok,
                `Status: ${getAllIncludingInactive.status}<br>–ù–∞–π–¥–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π: ${Array.isArray(getAllIncludingInactive.data) ? getAllIncludingInactive.data.length : 0}`);

            const categoriesResponse = await makeRequest('GET', `${baseUrl}/api/categories`);
            let categoryId = 1;
            if (categoriesResponse.ok && Array.isArray(categoriesResponse.data) && categoriesResponse.data.length > 0) {
                categoryId = categoriesResponse.data[0].id;
            }

            const createData = {
                title: `Test Listing ${Date.now()}`,
                description: 'Test listing description',
                price: 10000.50,
                categoryId: categoryId
            };
            const createResponse = await makeRequest('POST', `${baseUrl}/api/listings`, createData);
            addTestResult('listings', 'POST /api/listings', createResponse.ok && createResponse.status === 201,
                `Status: ${createResponse.status}<br>Data: <pre>${JSON.stringify(createResponse.data, null, 2)}</pre>`);
            
            if (createResponse.ok && createResponse.data && createResponse.data.id) {
                const listingId = createResponse.data.id;
                createdResources.listings.push(listingId);

                const getByIdResponse = await makeRequest('GET', `${baseUrl}/api/listings/${listingId}`);
                addTestResult('listings', `GET /api/listings/${listingId}`, getByIdResponse.ok,
                    `Status: ${getByIdResponse.status}<br>Data: <pre>${JSON.stringify(getByIdResponse.data, null, 2)}</pre>`);

                const getByCategoryResponse = await makeRequest('GET', `${baseUrl}/api/listings/category/${categoryId}`);
                addTestResult('listings', `GET /api/listings/category/${categoryId}`, getByCategoryResponse.ok,
                    `Status: ${getByCategoryResponse.status}<br>–ù–∞–π–¥–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π: ${Array.isArray(getByCategoryResponse.data) ? getByCategoryResponse.data.length : 0}`);

                const meResponse = await makeRequest('GET', `${baseUrl}/api/users/me`);
                if (meResponse.ok && meResponse.data && meResponse.data.id) {
                    const userId = meResponse.data.id;
                    const getByUserResponse = await makeRequest('GET', `${baseUrl}/api/listings/user/${userId}`);
                    addTestResult('listings', `GET /api/listings/user/${userId}`, getByUserResponse.ok,
                        `Status: ${getByUserResponse.status}<br>–ù–∞–π–¥–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π: ${Array.isArray(getByUserResponse.data) ? getByUserResponse.data.length : 0}`);

                    const getMyListingsResponse = await makeRequest('GET', `${baseUrl}/api/listings/user/me`);
                    addTestResult('listings', 'GET /api/listings/user/me', getMyListingsResponse.ok,
                        `Status: ${getMyListingsResponse.status}<br>–ù–∞–π–¥–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π: ${Array.isArray(getMyListingsResponse.data) ? getMyListingsResponse.data.length : 0}`);
                }

                const updateData = {
                    title: `Updated Listing ${Date.now()}`,
                    description: 'Updated description',
                    price: 15000.75,
                    categoryId: categoryId
                };
                const updateResponse = await makeRequest('PUT', `${baseUrl}/api/listings/${listingId}`, updateData);
                addTestResult('listings', `PUT /api/listings/${listingId}`, updateResponse.ok,
                    `Status: ${updateResponse.status}<br>Data: <pre>${JSON.stringify(updateResponse.data, null, 2)}</pre>`);

                const deactivateResponse = await makeRequest('POST', `${baseUrl}/api/listings/${listingId}/deactivate`);
                addTestResult('listings', `POST /api/listings/${listingId}/deactivate`, deactivateResponse.ok,
                    `Status: ${deactivateResponse.status}<br>Data: <pre>${JSON.stringify(deactivateResponse.data, null, 2)}</pre>`);

                const deleteResponse = await makeRequest('DELETE', `${baseUrl}/api/listings/${listingId}`);
                addTestResult('listings', `DELETE /api/listings/${listingId}`, deleteResponse.ok && deleteResponse.status === 204,
                    `Status: ${deleteResponse.status}`);
                
                if (deleteResponse.ok) {
                    createdResources.listings = createdResources.listings.filter(id => id !== listingId);
                }
            }
        }

        async function testMessages() {
            const baseUrl = getBaseUrl();
            await login(getTestUsername(), getTestPassword());

            const meResponse = await makeRequest('GET', `${baseUrl}/api/users/me`);
            if (!meResponse.ok || !meResponse.data || !meResponse.data.id) {
                addTestResult('messages', 'GET /api/users/me (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID)', false, '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }
            const currentUserId = meResponse.data.id;

            const categoriesResponse = await makeRequest('GET', `${baseUrl}/api/categories`);
            let categoryId = 1;
            if (categoriesResponse.ok && Array.isArray(categoriesResponse.data) && categoriesResponse.data.length > 0) {
                categoryId = categoriesResponse.data[0].id;
            }

            const createListingData = {
                title: `Test Listing for Messages ${Date.now()}`,
                description: 'Test listing for message testing',
                price: 5000.00,
                categoryId: categoryId
            };
            const createListingResponse = await makeRequest('POST', `${baseUrl}/api/listings`, createListingData);
            
            if (!createListingResponse.ok || !createListingResponse.data || !createListingResponse.data.id) {
                addTestResult('messages', '–°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π', false, '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ');
                return;
            }
            const listingId = createListingResponse.data.id;
            createdResources.listings.push(listingId);

            const listingOwnerId = createListingResponse.data.user ? createListingResponse.data.user.id : currentUserId;

            await login(getTestUsername2(), getTestPassword2());
            const user2Response = await makeRequest('GET', `${baseUrl}/api/users/me`);
            const user2Id = user2Response.ok && user2Response.data ? user2Response.data.id : null;

            if (user2Id && user2Id !== listingOwnerId) {
                const createMessageData = {
                    text: `Test message ${Date.now()}`,
                    listingId: listingId,
                    receiverId: listingOwnerId
                };
                const createMessageResponse = await makeRequest('POST', `${baseUrl}/api/messages`, createMessageData);
                addTestResult('messages', 'POST /api/messages', createMessageResponse.ok && createMessageResponse.status === 201,
                    `Status: ${createMessageResponse.status}<br>Data: <pre>${JSON.stringify(createMessageResponse.data, null, 2)}</pre>`);
                
                if (createMessageResponse.ok && createMessageResponse.data && createMessageResponse.data.id) {
                    const messageId = createMessageResponse.data.id;
                    createdResources.messages.push(messageId);

                    const getByIdResponse = await makeRequest('GET', `${baseUrl}/api/messages/${messageId}`);
                    addTestResult('messages', `GET /api/messages/${messageId}`, getByIdResponse.ok,
                        `Status: ${getByIdResponse.status}<br>Data: <pre>${JSON.stringify(getByIdResponse.data, null, 2)}</pre>`);

                    const getByListingResponse = await makeRequest('GET', `${baseUrl}/api/messages/listing/${listingId}`);
                    addTestResult('messages', `GET /api/messages/listing/${listingId}`, getByListingResponse.ok,
                        `Status: ${getByListingResponse.status}<br>–ù–∞–π–¥–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π: ${Array.isArray(getByListingResponse.data) ? getByListingResponse.data.length : 0}`);

                    const getConversationResponse = await makeRequest('GET', `${baseUrl}/api/messages/listing/${listingId}/conversation`);
                    addTestResult('messages', `GET /api/messages/listing/${listingId}/conversation`, getConversationResponse.ok,
                        `Status: ${getConversationResponse.status}<br>–ù–∞–π–¥–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π: ${Array.isArray(getConversationResponse.data) ? getConversationResponse.data.length : 0}`);

                    const getSentResponse = await makeRequest('GET', `${baseUrl}/api/messages/sent`);
                    addTestResult('messages', 'GET /api/messages/sent', getSentResponse.ok,
                        `Status: ${getSentResponse.status}<br>–ù–∞–π–¥–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π: ${Array.isArray(getSentResponse.data) ? getSentResponse.data.length : 0}`);

                    const getReceivedResponse = await makeRequest('GET', `${baseUrl}/api/messages/received`);
                    addTestResult('messages', 'GET /api/messages/received', getReceivedResponse.ok,
                        `Status: ${getReceivedResponse.status}<br>–ù–∞–π–¥–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π: ${Array.isArray(getReceivedResponse.data) ? getReceivedResponse.data.length : 0}`);

                    const updateData = {
                        text: `Updated message ${Date.now()}`
                    };
                    const updateResponse = await makeRequest('PUT', `${baseUrl}/api/messages/${messageId}`, updateData);
                    addTestResult('messages', `PUT /api/messages/${messageId}`, updateResponse.ok,
                        `Status: ${updateResponse.status}<br>Data: <pre>${JSON.stringify(updateResponse.data, null, 2)}</pre>`);

                    const markReadResponse = await makeRequest('POST', `${baseUrl}/api/messages/${messageId}/read`);
                    addTestResult('messages', `POST /api/messages/${messageId}/read`, markReadResponse.ok,
                        `Status: ${markReadResponse.status}<br>Data: <pre>${JSON.stringify(markReadResponse.data, null, 2)}</pre>`);

                    const deleteResponse = await makeRequest('DELETE', `${baseUrl}/api/messages/${messageId}`);
                    addTestResult('messages', `DELETE /api/messages/${messageId}`, deleteResponse.ok && deleteResponse.status === 204,
                        `Status: ${deleteResponse.status}`);
                    
                    if (deleteResponse.ok) {
                        createdResources.messages = createdResources.messages.filter(id => id !== messageId);
                    }
                }
            }

            await login(getTestUsername(), getTestPassword());
            const deleteListingResponse = await makeRequest('DELETE', `${baseUrl}/api/listings/${listingId}`);
            if (deleteListingResponse.ok) {
                createdResources.listings = createdResources.listings.filter(id => id !== listingId);
            }
        }

        async function testReports() {
            const baseUrl = getBaseUrl();
            await login(getTestUsername(), getTestPassword());

            const getAllResponse = await makeRequest('GET', `${baseUrl}/api/reports`);
            addTestResult('reports', 'GET /api/reports', getAllResponse.ok,
                `Status: ${getAllResponse.status}<br>–ù–∞–π–¥–µ–Ω–æ –∂–∞–ª–æ–±: ${Array.isArray(getAllResponse.data) ? getAllResponse.data.length : 0}`);

            const categoriesResponse = await makeRequest('GET', `${baseUrl}/api/categories`);
            let categoryId = 1;
            if (categoriesResponse.ok && Array.isArray(categoriesResponse.data) && categoriesResponse.data.length > 0) {
                categoryId = categoriesResponse.data[0].id;
            }

            const createListingData = {
                title: `Test Listing for Reports ${Date.now()}`,
                description: 'Test listing for report testing',
                price: 3000.00,
                categoryId: categoryId
            };
            const createListingResponse = await makeRequest('POST', `${baseUrl}/api/listings`, createListingData);
            
            if (!createListingResponse.ok || !createListingResponse.data || !createListingResponse.data.id) {
                addTestResult('reports', '–°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∂–∞–ª–æ–±', false, '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ');
                return;
            }
            const listingId = createListingResponse.data.id;
            createdResources.listings.push(listingId);

            await login(getTestUsername2(), getTestPassword2());

            const createReportData = {
                reason: `Test report reason ${Date.now()}`,
                listingId: listingId
            };
            const createReportResponse = await makeRequest('POST', `${baseUrl}/api/reports`, createReportData);
            addTestResult('reports', 'POST /api/reports', createReportResponse.ok && createReportResponse.status === 201,
                `Status: ${createReportResponse.status}<br>Data: <pre>${JSON.stringify(createReportResponse.data, null, 2)}</pre>`);
            
            if (createReportResponse.ok && createReportResponse.data && createReportResponse.data.id) {
                const reportId = createReportResponse.data.id;
                createdResources.reports.push(reportId);

                const getByIdResponse = await makeRequest('GET', `${baseUrl}/api/reports/${reportId}`);
                addTestResult('reports', `GET /api/reports/${reportId}`, getByIdResponse.ok,
                    `Status: ${getByIdResponse.status}<br>Data: <pre>${JSON.stringify(getByIdResponse.data, null, 2)}</pre>`);

                const getByListingResponse = await makeRequest('GET', `${baseUrl}/api/reports/listing/${listingId}`);
                addTestResult('reports', `GET /api/reports/listing/${listingId}`, getByListingResponse.ok,
                    `Status: ${getByListingResponse.status}<br>–ù–∞–π–¥–µ–Ω–æ –∂–∞–ª–æ–±: ${Array.isArray(getByListingResponse.data) ? getByListingResponse.data.length : 0}`);

                const getUserReportsResponse = await makeRequest('GET', `${baseUrl}/api/reports/user`);
                addTestResult('reports', 'GET /api/reports/user', getUserReportsResponse.ok,
                    `Status: ${getUserReportsResponse.status}<br>–ù–∞–π–¥–µ–Ω–æ –∂–∞–ª–æ–±: ${Array.isArray(getUserReportsResponse.data) ? getUserReportsResponse.data.length : 0}`);

                const getByStatusResponse = await makeRequest('GET', `${baseUrl}/api/reports/status/PENDING`);
                addTestResult('reports', 'GET /api/reports/status/PENDING', getByStatusResponse.ok,
                    `Status: ${getByStatusResponse.status}<br>–ù–∞–π–¥–µ–Ω–æ –∂–∞–ª–æ–±: ${Array.isArray(getByStatusResponse.data) ? getByStatusResponse.data.length : 0}`);

                await login('admin', 'admin');
                const updateStatusData = { status: 'RESOLVED' };
                const updateStatusResponse = await makeRequest('PUT', `${baseUrl}/api/reports/${reportId}/status`, updateStatusData);
                addTestResult('reports', `PUT /api/reports/${reportId}/status`, updateStatusResponse.ok,
                    `Status: ${updateStatusResponse.status}<br>Data: <pre>${JSON.stringify(updateStatusResponse.data, null, 2)}</pre>`);

                const deleteResponse = await makeRequest('DELETE', `${baseUrl}/api/reports/${reportId}`);
                addTestResult('reports', `DELETE /api/reports/${reportId}`, deleteResponse.ok && deleteResponse.status === 204,
                    `Status: ${deleteResponse.status}`);
                
                if (deleteResponse.ok) {
                    createdResources.reports = createdResources.reports.filter(id => id !== reportId);
                }
            }

            await login(getTestUsername(), getTestPassword());
            const deleteListingResponse = await makeRequest('DELETE', `${baseUrl}/api/listings/${listingId}`);
            if (deleteListingResponse.ok) {
                createdResources.listings = createdResources.listings.filter(id => id !== listingId);
            }
        }

        async function testUsers() {
            const baseUrl = getBaseUrl();
            await login(getTestUsername(), getTestPassword());

            const meResponse = await makeRequest('GET', `${baseUrl}/api/users/me`);
            addTestResult('users', 'GET /api/users/me', meResponse.ok,
                `Status: ${meResponse.status}<br>Data: <pre>${JSON.stringify(meResponse.data, null, 2)}</pre>`);
            
            if (meResponse.ok && meResponse.data && meResponse.data.id) {
                const userId = meResponse.data.id;
                const getByIdResponse = await makeRequest('GET', `${baseUrl}/api/users/${userId}`);
                addTestResult('users', `GET /api/users/${userId}`, getByIdResponse.ok,
                    `Status: ${getByIdResponse.status}<br>Data: <pre>${JSON.stringify(getByIdResponse.data, null, 2)}</pre>`);
            }

            const createUserData = {
                username: `testuser_${Date.now()}`,
                email: `test_${Date.now()}@example.com`,
                password: 'TestPassword123!',
                role: 'USER'
            };
            const createUserResponse = await makeRequest('POST', `${baseUrl}/api/users/create`, createUserData);
            addTestResult('users', 'POST /api/users/create', createUserResponse.ok,
                `Status: ${createUserResponse.status}<br>Data: <pre>${JSON.stringify(createUserResponse.data, null, 2)}</pre>`);
            
            if (createUserResponse.ok && createUserResponse.data && createUserResponse.data.id) {
                createdResources.users.push(createUserResponse.data.id);
            }
        }

        async function runAllTests() {
            clearResults();
            await testAuth();
            await testCategories();
            await testListings();
            await testMessages();
            await testReports();
            await testUsers();
        }

        window.onload = function() {
            if (localStorage.getItem(BASE_URL_KEY)) {
                document.getElementById('baseUrl').value = localStorage.getItem(BASE_URL_KEY);
            }
            if (localStorage.getItem(TEST_USERNAME_KEY)) {
                document.getElementById('testUsername').value = localStorage.getItem(TEST_USERNAME_KEY);
            }
        };

        document.getElementById('baseUrl').addEventListener('change', function() {
            localStorage.setItem(BASE_URL_KEY, this.value);
        });

        document.getElementById('testUsername').addEventListener('change', function() {
            localStorage.setItem(TEST_USERNAME_KEY, this.value);
        });
    </script>
</body>
</html>

