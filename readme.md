# Доска объявлений

Веб-приложение для размещения и управления объявлениями с возможностью общения между пользователями и системой модерации.

## 1. Тема проекта

Реализована **доска объявлений** (аналог Avito, OLX) — платформа, где пользователи могут:
- Размещать объявления о продаже товаров и услуг
- Просматривать объявления других пользователей
- Общаться с продавцами через встроенную систему сообщений
- Подавать жалобы на некорректные объявления
- Управлять своими объявлениями (создание, редактирование, удаление, деактивация)

## 2. Основные сущности

### 2.1. User (Пользователь)
Сущность представляет зарегистрированного пользователя системы.

**Поля:**
- `id` — уникальный идентификатор
- `username` — имя пользователя (уникальное)
- `email` — электронная почта
- `password` — пароль (хешируется с помощью BCrypt)
- `role` — роль пользователя (`USER` или `ADMIN`)
- `enabled` — статус активности аккаунта

**Связи:**
- Один пользователь может иметь множество объявлений (One-to-Many с Listing)
- Один пользователь может отправлять и получать множество сообщений (One-to-Many с Message)
- Один пользователь может подавать множество жалоб (One-to-Many с Report)

### 2.2. Category (Категория)
Сущность представляет категорию объявлений для их классификации.

**Поля:**
- `id` — уникальный идентификатор
- `name` — название категории (уникальное)
- `description` — описание категории

**Связи:**
- Одна категория может содержать множество объявлений (One-to-Many с Listing)

**Предустановленные категории:**
- Электроника
- Недвижимость
- Автомобили
- Одежда и обувь
- Мебель
- Бытовая техника
- Спорт и отдых
- Животные
- Работа
- Услуги
- Хобби и развлечения
- Детские товары

### 2.3. Listing (Объявление)
Сущность представляет объявление о продаже товара или услуги.

**Поля:**
- `id` — уникальный идентификатор
- `title` — заголовок объявления
- `description` — описание товара/услуги
- `price` — цена
- `isActive` — флаг активности объявления
- `createdAt` — дата создания
- `updatedAt` — дата последнего обновления

**Связи:**
- Принадлежит одному пользователю (Many-to-One с User)
- Принадлежит одной категории (Many-to-One с Category)
- Может содержать множество сообщений (One-to-Many с Message)
- Может иметь множество жалоб (One-to-Many с Report)

### 2.4. Message (Сообщение)
Сущность представляет сообщение в переписке между пользователями по объявлению.

**Поля:**
- `id` — уникальный идентификатор
- `text` — текст сообщения
- `isRead` — флаг прочтения сообщения
- `createdAt` — дата создания

**Связи:**
- Принадлежит одному объявлению (Many-to-One с Listing)
- Имеет отправителя (Many-to-One с User как sender)
- Имеет получателя (Many-to-One с User как receiver)

### 2.5. Report (Жалоба)
Сущность представляет жалобу пользователя на объявление.

**Поля:**
- `id` — уникальный идентификатор
- `reason` — причина жалобы
- `status` — статус обработки (`PENDING`, `APPROVED`, `REJECTED`)
- `createdAt` — дата создания

**Связи:**
- Принадлежит одному объявлению (Many-to-One с Listing)
- Принадлежит одному пользователю (Many-to-One с User)

**Ограничения:**
- Один пользователь может подать только одну жалобу на одно объявление (уникальное ограничение на пару `user_id`, `listing_id`)

## 3. Операции сервиса

### 3.1. Аутентификация и авторизация

**Регистрация пользователя:**
- `POST /auth/register` — регистрация нового пользователя с валидацией пароля

**Вход в систему:**
- `POST /auth/login` — аутентификация пользователя, возвращает JWT токены (access и refresh)

**Обновление токенов:**
- `POST /auth/refresh` — обновление пары токенов по refresh-токену

**Аутентификация:**
- Используется JWT (JSON Web Tokens) для защиты API
- Токен передается в заголовке `Authorization: Bearer <token>`
- Поддерживаются роли: `USER` и `ADMIN`

### 3.2. Операции с категориями (Category)

**Просмотр:**
- `GET /api/categories` — получить все категории (публичный доступ)
- `GET /api/categories/{id}` — получить категорию по ID (публичный доступ)

**Управление (требуется аутентификация):**
- `POST /api/categories` — создать новую категорию (роли: USER, ADMIN)
- `PUT /api/categories/{id}` — обновить категорию (роли: USER, ADMIN)
- `DELETE /api/categories/{id}` — удалить категорию (только ADMIN)

### 3.3. Операции с объявлениями (Listing)

**Просмотр (публичный доступ):**
- `GET /api/listings` — получить все активные объявления
- `GET /api/listings/all` — получить все объявления (включая неактивные)
- `GET /api/listings/{id}` — получить объявление по ID
- `GET /api/listings/category/{categoryId}` — получить объявления по категории
- `GET /api/listings/user/{userId}` — получить объявления пользователя

**Управление (требуется аутентификация):**
- `GET /api/listings/user/me` — получить свои объявления (роли: USER, ADMIN)
- `POST /api/listings` — создать новое объявление (роли: USER, ADMIN)
- `PUT /api/listings/{id}` — обновить объявление (роли: USER, ADMIN, только свои)
- `POST /api/listings/{id}/deactivate` — деактивировать объявление (роли: USER, ADMIN, только свои)
- `DELETE /api/listings/{id}` — удалить объявление (роли: USER, ADMIN, только свои)

### 3.4. Операции с сообщениями (Message)

**Просмотр (требуется аутентификация):**
- `GET /api/messages/{id}` — получить сообщение по ID (роли: USER, ADMIN)
- `GET /api/messages/listing/{listingId}` — получить все сообщения по объявлению (роли: USER, ADMIN)
- `GET /api/messages/listing/{listingId}/conversation` — получить переписку по объявлению для текущего пользователя (роли: USER, ADMIN)
- `GET /api/messages/sent` — получить отправленные сообщения (роли: USER, ADMIN)
- `GET /api/messages/received` — получить полученные сообщения (роли: USER, ADMIN)

**Управление (требуется аутентификация):**
- `POST /api/messages` — создать сообщение (роли: USER, ADMIN)
- `PUT /api/messages/{id}` — обновить сообщение (роли: USER, ADMIN, только свои)
- `POST /api/messages/{id}/read` — пометить сообщение как прочитанное (роли: USER, ADMIN, только полученные)
- `DELETE /api/messages/{id}` — удалить сообщение (роли: USER, ADMIN, только свои)

### 3.5. Операции с жалобами (Report)

**Просмотр (требуется аутентификация):**
- `GET /api/reports` — получить все жалобы (роли: USER, ADMIN)
- `GET /api/reports/{id}` — получить жалобу по ID (роли: USER, ADMIN)
- `GET /api/reports/listing/{listingId}` — получить жалобы по объявлению (роли: USER, ADMIN)
- `GET /api/reports/user` — получить жалобы текущего пользователя (роли: USER, ADMIN)
- `GET /api/reports/status/{status}` — получить жалобы по статусу (роли: USER, ADMIN)

**Управление (требуется аутентификация):**
- `POST /api/reports` — создать жалобу на объявление (роли: USER, ADMIN, одна жалоба на объявление)
- `PUT /api/reports/{id}/status` — обновить статус жалобы (только ADMIN)
- `DELETE /api/reports/{id}` — удалить жалобу (только ADMIN)

### 3.6. Операции с пользователями (User)

**Просмотр (требуется аутентификация):**
- `GET /api/users/me` — получить информацию о текущем пользователе (роли: USER, ADMIN)
- `GET /api/users/{id}` — получить пользователя по ID (роли: USER, ADMIN)

**Управление (требуется аутентификация):**
- `POST /api/users/create` — создать нового пользователя (роли: USER, ADMIN)
- `PUT /api/users/{id}` — обновить пользователя (роли: USER, ADMIN)
- `DELETE /api/users/{id}` — удалить пользователя (только ADMIN)

### 3.7. Веб-интерфейс

**Публичные страницы:**
- `GET /` — главная страница со списком объявлений
- `GET /login` — страница входа
- `GET /register` — страница регистрации
- `GET /listings/{id}` — страница просмотра объявления

**Защищенные страницы (требуется аутентификация):**
- `GET /my-listings` — страница управления своими объявлениями (роли: USER, ADMIN)
- `GET /listings/create` — страница создания объявления (роли: USER, ADMIN)
- `GET /listings/{id}/edit` — страница редактирования объявления (роли: USER, ADMIN, только свои)
- `GET /messages` — страница просмотра сообщений (роли: USER, ADMIN)

**Административная панель (только ADMIN):**
- `GET /admin/listings` — управление всеми объявлениями
- `GET /admin/categories` — управление категориями
- `GET /admin/reports` — управление жалобами

## Технологический стек

- **Backend:** Spring Boot 3.x
- **База данных:** H2 (для разработки), PostgreSQL (для продакшена)
- **ORM:** Spring Data JPA / Hibernate
- **Безопасность:** Spring Security с JWT аутентификацией
- **Frontend:** Thymeleaf, HTML, CSS, JavaScript
- **Сборка:** Maven

## Особенности реализации

1. **JWT аутентификация** — stateless аутентификация через JSON Web Tokens
2. **Ролевая модель** — разделение прав доступа между обычными пользователями и администраторами
3. **Валидация данных** — проверка паролей, уникальности пользователей и категорий
4. **Защита от дублирования** — ограничение на повторные жалобы одного пользователя на одно объявление
5. **Веб-интерфейс** — полнофункциональный UI для работы с объявлениями
6. **RESTful API** — полная поддержка всех HTTP методов (GET, POST, PUT, DELETE)
